////////////////////////////////////////////

       太鼓さん次郎2    Ver. 0.98

////////////////////////////////////////////

※このソフトの動作にはDirectX9が必要となります。

○概要

太鼓さん次郎の作り直しテスト版です。
太鼓さん次郎と同じフォルダに置いても大体同じように画像が表示されない他不都合が生じるので、
同居させる場合は太鼓さん次郎2を別のフォルダに置いた上で
config.iniのRootDirectoryに太鼓さん次郎のフォルダを指定してください。


○主な相違点・未実装な点

・譜面ファイルはtjaのみ対応（tjfは未対応）
・mp3は未対応
・太鼓さん次郎と同じファイルでもずれる場合がある
・色々音が足りない

・画像ファイルの読み込み方が違う（重要）

・スコアの保存形式が違う（太鼓さん次郎のスコアデータのみ存在する場合はそちらを読みます）
・Rキーを押すとリプレイを再生できるかもしれない（動きが怪しい部分アリ）


○画像ファイルに関して

・themeフォルダ内のフォルダで一括して扱います（config.iniのSkinName=で起動時に読み込むフォルダを指定）。

・フォルダ名と同じcsvファイルを最初に読み込みます（defaultならdefault/default.csv）

・default.csv内で指定したcsvファイルを読み込みます（シングルプレイ時は#SINGLEに指定したcsv）


・仕様変更によりtjaファイルと同じフォルダにあるimgフォルダの中身はbg関連以外読みません。

・tjaファイルと同じフォルダに（tjaファイルのあるフォルダ名）.csv を作ると一往読ませることは可能です。
　その場合で更にフォルダを作って画像を入れる場合、フォルダ名は「img」以外のものを使用してください。


○追加説明とか

・TOTAL:	ノルマゲージの増える量を指定します。
			100を指定した場合、全ての音符を良で取った時にゲージが満タンになります。
			80未満の値を指定した場合は、難度によりクリア不可能となります。

連絡は toach@hotmail.co.jp までお願いします。
返信は極端に遅れるか返信し損ねることも多いので、
返信がない場合はもう一度送っていただけると返信が来るかも知れません。


○今後の更新について

太鼓さん次郎の更新は停止しています。太鼓さん次郎2の更新は気分次第により未定です。
なおこれらのソースコードは公開いたしませんのでご了承ください。

また、既に幾つかあるようですが、もしTJAファイルを使ったソフトを何かしら作ろうという方がいましたらご自由にどうぞ。
その際はフォーマットも独自に拡張していただいて構いません。



○更新履歴
2015/07/20	0.98	分岐のある譜面にて分岐後の音符が描画されない不具合を修正
			SCOREDIFF:にて旧配点（dをつける）を指定した際に200コンボ以降及びゴーゴー時の加算がされていなかったので修正
			tjcファイルのプレイに取り敢えず対応（縦書き時の表示が次郎と異なります）　ノルマ等は後に追加するかも
2015/02/05	0.97	画面の描画処理を一部変更
			#SCROLLの値を複素数に対応させてみる(例:1+0.2i)　但しthemeを弄らないとほぼまともに視認できないので注意
			併せてREFLECモード時の挙動を変更
2014/02/09	0.96	リプレイ再生時は現在の表示位置に関係なく曲の最初から開始するよう修正
			連打時にコースシンボルが光るよう修正
			explosion画像を判定と音符の大きさで別に指定する形に変更(これまでの形式でも使えます)
			keyconf.iniによる簡易キーコンフィグに対応（太鼓さん次郎と同様）
			他細々と修正
2013/12/22	0.95	スコア保存の太鼓さん次郎と互換性のない新形式に変更してみる（.tjscr、譜面データを書き換えるとだいたいの場合リセットされます　シングル譜面限定）
			ハイスコアが出たときのリプレイデータを保存するようにしてみる（.tjrpl、譜面を読み込んだ後Rキーを押すと再生されます　シングル譜面限定）
			リザルト画面で放置するとスコアが暴走する現象を修正
			一小節の間に休符(0)を含む音符がなく、かつ#BPMや#SCROLLが含まれる場合に譜面が正しく読まれないバグをたぶん修正
			画像ファイル設定にて#NOTEBOUNDの最初の値を0にしても音符がその場で消えないミスを修正
2013/11/03	0.94a	2P側のmtaikoflowerが1P側と同じタイミングで表示されるミスを修正
2013/11/03	0.94	コースごとにTOTAL値を指定している際、ファイルの一番下に書かれた値のみが読まれるバグを修正
			mtaikoflowerの表示を修正
			2P側の判定、コースシンボル、スコア、ゲキ連打時のキャラが正しく表示されないバグを修正
			他細々と修正
2013/09/12	0.93	TOTAL:でノルマゲージの増える量を指定できるようにしてみる
			ノルマゲージの幅の設定が反映されないミスを修正
2013/06/09	0.92a	一定コンボ毎に鳴る音声とフルコンボ時の音声を指定できるようにしてみる（theme/default/sound.csv参照）
			クリア状態やスコアが保存されないことが多いバグをきっと修正
			他細々と修正
2012/12/25	0.91a	環境により起動直後のマルチサンプリングのチェック時にエラーとして終了してしまうバグを修正
2012/12/20	0.91	太鼓音もtheme内のcsvで読み込むようにする
			DirectInputの初期化に失敗した場合もその場で終了せず続行するように
			選曲画面でもドンカツ音が鳴るようにする
			explosion画像に1x1コマの画像を使用したときに描画されないミスを修正
			逆走する音符の描画を修正
			2Pプレイ時の太鼓音読み込み時のパンが一部おかしかったのを修正
			起動直後の選曲画面でのデモ再生位置がずれているのを修正
			飛ぶ音符の描画順序を変更（各種バルーン・スコアの奥へ移動）
			画像の動作周りの内部処理を変更中
			他細々と修正
2012/12/09	0.90a	主に選曲画面のタイトル文字が縮小されるとき、文字が消える場合があるのを修正
2012/12/08	0.90	画像読み込み方式を大幅に変更（dispconf.iniとimgdet.iniの撤廃、themeフォルダ内のcsvファイルで指定するように）
			（最初に読み込むtheme内のフォルダはconfig.iniのSkinName=で指定してください）
			上に関連してtjaと同じフォルダ内にあるimgフォルダを読まないように（bg画像だけはスクロール無しで読み込みます）
			ハイスコアの読み込みとセーブを簡易的に実装（太鼓さん次郎とほぼ同じ）
			演奏画面で縁五回入力でオプションを変更可能に（縁で選択、面で決定 矢印キーも可）
			F8キーで画像の再読込みを行うように（選曲画面では曲リストの再読込み）
			環境により各種キー操作が効かないバグを多分修正
			連続で停止が入る譜面が期待通りに読み込まれない場合があるのを修正
			SCOREMODE=2の時の大音符の得点計算を変更（単純に小音符の2倍の得点とする）
			難度ごとにノルマが変わるようにする（下の難度ほど好い加減な設定です）
			他細々と修正
2012/07/13	0.82	今年分の更新履歴を2012年に修正
			dispconf.iniのResultSongSubTitleが機能していなかったのを修正
			NormaGauge画像が無い時、ノルマクリア時にフリーズするバグを修正
			genre.iniの色指定を#bbggrrから#rrggbbに修正
			連打開始の文字を連続で並べた時、2文字目以降が無視されるバグを修正
			プレイ画面の曲タイトルにもconfig.iniのSelectFontNameが反映されるようにする
			縦書き時、フォントを変えても比較的文字が重なりにくいようにしてみる
			config.iniのDisplayType=1の時はCourseSymbolがMTaikoの後に描画されるようにしてみる
			分岐のある譜面で再生していない時、カーソルキー上下で譜面を切り替えられるように
			再生中にF11/F12キーでOFFSETの値を一時的に変更できるようにしてみる（値は保存されず、再生が終わるとリセットされます）
			その関連でfont画像にマイナスの文字が無かったので追加（以前のままでも大した影響はありません）
			他細々と修正
2012/04/01	0.80	魂の位置を少し右寄りに
			dispconf.iniで譜面スクロール領域の幅・X位置を変更できるように（ScrollFieldX、ScrollFieldWidth）（省略時はデフォルト）
			dispconf.iniでMTaikoの位置を変更できるように（MTaikoX、MTaikoY）（省略時はデフォルト）
			音符を叩いた時に画面左から右に流れるものを取り敢えず実装してみる（runner、画像最上段がミス時のもので以下数を増やす時はimgdet.iniのRunnerColorsの値を変更）
			explosion_lowerの描画及びExplosionFramesが1の時のexplosionの描画を修正
			カンマのみの小節を何も無い小節と看做すように修正
			他細々と修正
2012/03/25	0.79	一行に二小節分以上の記述がされていたときのバグを修正（カンマ以降を無視するように）
			WAVE:に指定されたファイルが存在しない時の譜面の再生開始位置を修正
			ゲキ連打及びイモ連打を叩ききったときの得点が一打分多く加算されているのを修正
			オートプレイ時、ゲキ連打の得点加算がおかしいバグを修正
			explosion_lowerの描画及びExplosionFramesが1の時のexplosionの描画を修正
			dispconf.iniのDancerYが無視されていたのを修正
			他細々と修正
2012/02/18	0.78c	dispconf.ini内で読まれていない値があったのを一部修正
2012/02/18	0.78b	曲のデモを再生すると譜面ファイルがロックされるバグを修正
			1打の風船があるとオート時にエラーが出るバグを修正
2012/02/18	0.78	起動時に読み込み中のファイル名が表示されるようにする
			選曲画面の背景（songselectbg）に対応
			config.iniのSongSelect=2で選曲画面を怪しい縦書き表示になるようにしてみる
			選曲画面で曲のデモが流れるようにする
			一定コンボ数以上のとき、imgdet.iniのNoteFramesの値により音符画像が動くように
			config.iniにDisplayTypeを追加（0のとき横縦比4:3、1のとき横縦比16:9の画面であるとして扱う）
2012/02/10	0.75b	初期状態での風船の割る速度を修正
2012/02/09	0.75	config.iniのJudgeLevel及びJudgeRangeを読みとるように（仕様は太鼓さん次郎と多分同じ）
			オートプレイで風船を割れなかった場合も割れた場合の点数が入っている現象を修正
			config.iniにオートプレイの連打の最大速度AutoRollSpeedを追加（単位は打/秒、0でデフォルト（黄色連打約20打/秒、風船は出来るだけ））
			（0以外の時は風船も黄色連打と同じ速度）
2012/02/07	0.73	コンボボーナスとゴーゴータイムによる獲得スコアの1の位の切り捨て方法を修正
2011/12/16	0.72b	連打の配点ミスを修正
2011/12/16	0.72	演奏画面でdispconf.iniを読みこむように（譜面ファイルと同じフォルダにあるファイルも読みます）
			SCOREINIT:およびSCORDIFF:が無視されていたらしいのを修正
			ヘッダにSCOREMODE:を追加してみる（0:ドンだフル, 1:AC14以前, 2:新）（指定なしだと1）
			Playspeedを変えた際の演奏画面での挙動を修正
2011/11/10	0.70	画像読み込み時にメモリリークすることがあったバグを修正
			選曲画面での裏表の変更を実装、難度選択状態でKを10回押しても切り替え可能に
			ヘッダにSIDEREV:を追加（表⇔裏の関係を示す）（sample1にサンプルあり）
2011/09/02	0.65	譜面のズレを少なくする等、ある程度まともな状態に（しかしα）
2011/05/05	0.60	見切り発車